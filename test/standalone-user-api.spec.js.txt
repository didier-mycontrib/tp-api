import {use} from  'chai';
import chaiHttp  from 'chai-http';
import { app , server } from '../server.js';
import { initMongodbContainer , initMainDataSet , removeMainDataSet,
  classicHttpCrudTest } from './generic-chai-http-mocha-test.js';
import { test } from 'mocha';


//NB: in script (.sh, .bat , ...) : set/export WITHOUT_AUTH=yes // undefined by default
//WITHOUT THAT , security (auth check) will block private requests (post, ..)

const chai=use(chaiHttp); //configure chai to use chaiHttp
//NB: run mocha with --exit option for good server exit after test execution

const { expect } = chai;

function retreiveMyAppRequester(){
    return chai.request.execute(app);//"http://localhost:8230" or ...
    //NB: this code may change in other chai,chaiHttp versions
}

let testContext = {
  chai : chai,
  expect : expect,
  app : app,
  httpRequesterFn : retreiveMyAppRequester ,
  mainDataSetFilePath : "test/dataset/users.json" ,
  entityToAddFilePath : "test/dataset/new_user.json" ,
  entityToUpdateFilePath : "test/dataset/update_user.json" ,
  mainPrivateURL:"/standalone-user-api/v1/private/users" ,
  mainPublicURL:"/standalone-user-api/v1/public/users" ,
  extractIdFn : (user) => user.id ,
  setIdFn: (user,id) => { user.id = id } ,
  testEssentialSameValues: (e1,e2) => {
      expect(e1.firstName).to.equal(e2.firstName);
      expect(e1.lastName).to.equal(e2.lastName);
      expect(e1.email).to.equal(e2.email);
      expect(e1.newPassword).to.equal(e2.newPassword);
      expect(e1.mainGroup).to.equal(e2.mainGroup);
   }
}

classicHttpCrudTest(testContext);
